---
description:
globs:
alwaysApply: false
---
# Rule: Memory Bank Initialization

## Description

Creates the Memory Bank structure when triggered by project/task conditions and user confirmation.

## Trigger Conditions

- The `memory_bank_status` must be 'inactive'
- AND (project is new OR user requested initialization OR task is complex requiring persistence)

## Flow Diagram

```mermaid
flowchart TD
    Start([Rule Triggered]) --> CheckStatus{memory_bank_status == 'inactive'?}
    CheckStatus -->|No| End([Stop])

    CheckStatus -->|Yes| Confirm{User confirms?}
    Confirm -->|No| End

    Confirm -->|Yes| CheckBrief{projectBrief.md exists?}
    CheckBrief -->|Yes| ReadBrief[Read projectBrief.md]
    CheckBrief -->|No| CreateFiles
    ReadBrief --> CreateFiles[Create Memory Bank Files]

    CreateFiles --> LoadUpdateRule[Load memory-bank-update.mdc rule]
    LoadUpdateRule --> LoadProgressRule[Load memory-bank-progress.mdc rule]
    LoadProgressRule --> UpdateStatus[Set memory_bank_status = 'active']
    UpdateStatus --> End

    subgraph "Files Created"
        CreateFiles --> ProductContext[productContext.md]
        CreateFiles --> ActiveContext[activeContext.md]
        CreateFiles --> Progress[progress.md]
        CreateFiles --> DecisionLog[decisionLog.md]
        CreateFiles --> SystemPatterns[systemPatterns.md]
    end
```

## Implementation

<thinking>
Check memory_bank_status to make sure we're not re-creating an existing Memory Bank.
</thinking>

1. Verify `memory_bank_status` is 'inactive' (stop if already active)

<thinking>
Always confirm with user before creating files/structure
</thinking>

2. Ask user: "Would you like to initialize a Memory Bank for this project?"
   - If **No**: Stop
   - If **Yes**: Continue

<thinking>
Look for existing project brief to use for initial context
</thinking>

3. Check for and read `projectBrief.md` if present

<thinking>
Create directory and standard files with templates, using timestamp for logs
</thinking>

4. Create the Memory Bank files with initial content:
   - `memory-bank/productContext.md`:
     ```md
     # Product Context

     This file provides a high-level overview of the project and the expected product that will be created. Initially it is based upon projectBrief.md (if provided) and all other available project-related information in the working directory. This file is intended to be updated as the project evolves, and should be used to inform all other modes of the project's goals and context.
     YYYY-MM-DD HH:MM:SS - Log of updates made will be appended as footnotes to the end of this file.

     *

     ## Project Goal

     *

     ## Key Features

     *

     ## Overall Architecture

     *
     ```
   - `memory-bank/activeContext.md`:
     ```md
     # Active Context

     This file tracks the project's current status, including recent changes, current goals, and open questions.
     YYYY-MM-DD HH:MM:SS - Log of updates made.

     *

     ## Current Focus

     *

     ## Recent Changes

     *

     ## Open Questions/Issues

     *
     ```
   - `memory-bank/progress.md`:
     ```md
     # Progress

     This file tracks the project's progress using a task list format.
     YYYY-MM-DD HH:MM:SS - Log of updates made.

     *

     ## Completed Tasks

     *

     ## Current Tasks

     *

     ## Next Steps

     *
     ```
   - `memory-bank/decisionLog.md`:
     ```md
     # Decision Log

     This file records architectural and implementation decisions using a list format.
     YYYY-MM-DD HH:MM:SS - Log of updates made.

     *

     ## Decision

     *

     ## Rationale

     *

     ## Implementation Details

     *
     ```
   - `memory-bank/systemPatterns.md`:
     ```md
     # System Patterns *Optional*

     This file documents recurring patterns and standards used in the project.
     It is optional, but recommended to be updated as the project evolves.
     YYYY-MM-DD HH:MM:SS - Log of updates made.

     *

     ## Coding Patterns

     *

     ## Architectural Patterns

     *

     ## Testing Patterns

     *
     ```

5. Load the `.cursor/rules/agent/memory-bank-update.mdc` rule to enable update capabilities

6. Load the `.cursor/rules/agent/memory-bank-progress.mdc` rule to enable progress tracking

7. Set `memory_bank_status = 'active'`

## File Templates (Summary)

- **productContext.md**: Project goals, features, architecture
- **activeContext.md**: Current focus, recent changes, open questions
- **progress.md**: Completed/current/next tasks
- **decisionLog.md**: Decisions with rationale
- **systemPatterns.md**: Coding/architectural/testing patterns
